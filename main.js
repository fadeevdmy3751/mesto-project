(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keyup",e.ESChandler),e.ESChandler=null}function o(e){e.classList.add("popup_opened"),e.ESChandler=function(e){return function(o){"Escape"===o.key&&t(e)}}(e),document.addEventListener("keyup",e.ESChandler)}e.d({},{a:()=>L});var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"7da4e682-e653-495f-9d74-1a03b7d57194","Content-Type":"application/json"}},n="/cards",c="/users/me",a="/cards/likes/";function l(e){var t=e.target.closest(".card");fetch(r.baseUrl+n+"/"+t._id,{method:"DELETE",headers:r.headers}).then((function(e){e.ok?(console.log("delete card success"),t.remove()):console.log("Ошибка deleteCard: ".concat(e.status))})).catch((function(e){console.log(e)}))}function u(e){var t=e.target.closest(".card");t.myLike?fetch(r.baseUrl+a+t._id,{method:"DELETE",headers:r.headers}).then((function(e){if(e.ok)return console.log("delete like success"),e.json();console.log("Ошибка delete like: ".concat(e.status))})).then((function(e){return m(t,e)})).catch((function(e){console.log(e)})):fetch(r.baseUrl+a+t._id,{method:"PUT",headers:r.headers}).then((function(e){if(e.ok)return console.log("put like success"),e.json();console.log("Ошибка put like: ".concat(e.status))})).then((function(e){return m(t,e)})).catch((function(e){console.log(e)}))}var i=document.querySelector("#card-template").content,s=document.querySelector(".big-img"),d=s.querySelector("img"),f=s.querySelector("figcaption");function m(e,t){e.querySelector(".card__like-count").textContent=t.likes.length,e.myLike=t.likes.some((function(e){return e._id===L})),e.myLike?e.querySelector(".card__like").classList.add("card__like_set"):e.querySelector(".card__like").classList.remove("card__like_set")}function p(e){var t=i.querySelector(".card").cloneNode(!0);t.querySelector(".card__name").textContent=e.name;var r=t.querySelector(".card__image");return r.alt=e.name,r.src=e.link,t._id=e._id,t.ownerId=e.owner._id,t.ownerId!==L?t.querySelector(".card__delete").style.display="none":t.querySelector(".card__delete").addEventListener("click",l),r.addEventListener("click",(function(){d.src=r.src,d.alt=e.name,f.textContent=e.name,o(s)})),m(t,e),t.querySelector(".card__like").addEventListener("click",u),t}function v(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];o?t.prepend(e):t.append(e)}var _={formSelector:".form",inputSelector:".form__field",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__field_error",errorClass:"form__error_visible"},h=function(e,t){var o=e.querySelector(t.formSelector),r=Array.from(e.querySelectorAll(t.inputSelector)),n=o.querySelector(t.submitButtonSelector);r.forEach((function(e){g(o,e,t.inputErrorClass,t.errorClass),e.value=""})),y(r,n,t.inactiveButtonClass)};function y(e,t,o){S(e)?(t.classList.add(o),t.disabled=!0):(t.classList.remove(o),t.disabled=!1)}var S=function(e){return e.some((function(e){return!e.validity.valid}))},q=function(e,t,o,r,n){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),c.textContent=o,c.classList.add(n)},g=function(e,t,o,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o),n.classList.remove(r),n.textContent=""},k=document.querySelector(".profile__name"),b=document.querySelector(".profile__description"),E=document.querySelector(".profile__avatar");function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e&&(k.textContent=e),t&&(b.textContent=t),o&&(E.style.backgroundImage="url('".concat(o,"')"))}var L,j,x=document.querySelector(".content"),P=x.querySelector(".profile__avatar"),A=document.querySelector(".popup-avatar-edit"),U=A.querySelector('.form[name="popup-avatar-edit-form"]'),O=document.querySelector(".popup-profile-edit"),B=x.querySelector(".profile__edit-button"),T=O.querySelector('.form[name="popup-profile-edit-form"]'),D=x.querySelector(".profile__name"),w=x.querySelector(".profile__description"),I=O.querySelector("#form__field-name"),N=O.querySelector("#form__field-profession"),J=U.querySelector("#form__field-ava"),H=document.querySelector(".popup-card-add"),M=x.querySelector(".profile__add-button"),z=H.querySelector('.form[name="popup-card-add-form"]'),F=H.querySelector("#card-add-name"),G=H.querySelector("#card-add-link"),K=x.querySelector(".elements"),Q=document.querySelectorAll(".popup"),R=document.querySelectorAll(".popup__close");fetch(r.baseUrl+n,{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка getInitialCards: ".concat(e.status))})).then((function(e){console.log("init cards",e),e.forEach((function(e){return v(p(e),K)}))})).catch((function(e){console.log(e)})),fetch(r.baseUrl+c,{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка getMe: ".concat(e.status))})).then((function(e){console.log("user",e),C(e.name,e.about,e.avatar),L=e._id})).catch((function(e){console.log(e)})),P.addEventListener("click",(function(){h(A,_),o(A)})),M.addEventListener("click",(function(){return o(H)})),B.addEventListener("click",(function(){h(O,_),o(O),I.value=D.textContent,N.value=w.textContent})),U.addEventListener("submit",(function(e){var o;e.preventDefault(),U.querySelector(".form__button").textContent="Сохранение...",(o=J.value,fetch(r.baseUrl+"/users/me/avatar",{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка editAvatar: ".concat(e.status))}))).then((function(e){console.log("user avatar updated",e),C(null,null,e.avatar)})).catch((function(e){console.log(e)})),t(A)})),T.addEventListener("submit",(function(e){var o,n;e.preventDefault(),T.querySelector(".form__button").textContent="Сохранение...",(o=I.value,n=N.value,fetch(r.baseUrl+c,{method:"PATCH",headers:r.headers,body:JSON.stringify({name:o,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка editProfile: ".concat(e.status))}))).then((function(e){console.log("userinfo updated",e),C(e.name,e.about)})).catch((function(e){console.log(e)})),t(O)})),M.addEventListener("click",(function(){h(H,_),o(H)})),z.addEventListener("submit",(function(e){var o,c;e.preventDefault(),z.querySelector(".form__button").textContent="Сохранение...",(o=F.value,c=G.value,fetch(r.baseUrl+n,{method:"POST",headers:r.headers,body:JSON.stringify({name:o,link:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка addCardOnServer: ".concat(e.status))}))).then((function(e){v(p(e),K,!0),t(H),F.value="",G.value=""})).catch((function(e){console.log(e)}))})),R.forEach((function(e){e.addEventListener("click",(function(){t(e.closest(".popup"))}))})),Q.forEach((function(e){e.addEventListener("click",(function(o){o.target.classList.contains("popup")&&t(e)}))})),j=_,Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);y(o,r,t.inactiveButtonClass),o.forEach((function(n){n.addEventListener("input",(function(){(function(e,t,o,r){t.validity.valid?g(e,t,o,r):q(e,t,t.validationMessage,o,r)})(e,n,t.inputErrorClass,t.errorClass),y(o,r,t.inactiveButtonClass)}))}))}(e,j)}))})();
//# sourceMappingURL=main.js.map